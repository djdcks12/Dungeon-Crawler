# 하드코어 던전 크롤러 - 프로젝트 로드맵 & 역기획서

**버전**: 3.0  
**최종 업데이트**: 2025-08-19  
**엔진**: Unity 6 LTS + Unity Netcode for GameObjects  
**최대 플레이어**: 16명 동시 멀티플레이어

---

## 📋 프로젝트 개요

### 🎯 핵심 비전
**"죽으면 모든 것을 잃지만, 영혼만은 영원하다"**

완전한 하드코어 경험을 제공하는 2D 탑뷰 로그라이크 던전 크롤러. 죽으면 모든 것을 잃지만, 0.1% 확률의 영혼만이 계정 전체에 누적되는 극한의 성장 시스템.

### 🚨 하드코어 특징
- **완전한 데스 페널티**: 죽으면 캐릭터 영구 삭제, 모든 진행도 소실
- **영혼 시스템**: 유일한 영구 진행도 (몬스터 0.1%, 플레이어 100% 드롭률)
- **PvP 활성화**: 던전 내 언제든 플레이어 간 전투 가능 (파티원 제외)
- **골드 기반 스킬**: 스킬 포인트 없음, 오직 골드로만 스킷 구매
- **극악의 드롭률**: 영혼 0.1%, 인챈트 1%, 전설 장비 0.5%

### 🎮 핵심 게임플레이 루프
```
캐릭터 생성 (종족 선택 + 영혼 상속)
    ↓
스킬 학습 (골드로 구매, 5티어 시스템)
    ↓
파티 구성 (최대 16명) 또는 솔로 플레이
    ↓
던전 입장 (5분마다 스케줄된 단체 입장)
    ↓
생존 및 성장 (PvE + PvP + 아이템 수집)
    ↓
사망 또는 클리어
    ↓
영혼 획득 → 계정 보존 → 새 캐릭터 생성
```

---

## 🏗️ 기술 아키텍처

### 📊 기술 스택
- **엔진**: Unity 6 LTS (Small Size Multi Complete 템플릿)
- **네트워킹**: Unity Netcode for GameObjects
- **아키텍처 패턴**: MVC (Model-View-Controller)
- **데이터 관리**: ScriptableObject + NetworkBehaviour 하이브리드
- **네트워크 동기화**: NetworkList/NetworkVariable + ServerRpc/ClientRpc

### 🔗 시스템 의존성 맵
```
PlayerController (핵심 허브)
├── PlayerStatsManager ↔ PlayerStats (ScriptableObject)
├── CombatSystem ↔ MonsterAI + MonsterHealth  
├── InventoryManager ↔ EquipmentManager + ItemInstance
├── SkillManager ↔ SkillData + SkillMaster
├── DeathManager ↔ ItemScatter + SoulPreservation + CharacterDeletion
├── PartyManager ↔ DungeonScheduler + DungeonManager
└── EnchantManager ↔ EnchantDropSystem (신규)
```

### 🎯 민댐/맥댐 시스템 (핵심 특징)
모든 공격이 최소 데미지~최대 데미지 범위를 가지는 시스템:
```csharp
// 기본 공격 계산
물리 기본 민댐 = (STR * 1.5) + (무기 민댐)
물리 기본 맥댐 = (STR * 2.5) + (무기 맥댐)  
실제 데미지 = Random(민댐, 맥댐) * 속성보정 * 치명타 * (1-방어율)

// 무기별 편차 예시
롱소드: 80-120% (안정형)
워해머: 40-160% (도박형)  
대거: 90-110% (안정하지만 저데미지)
```

---

## ✅ 개발 완료 현황 (베타 85% 완성)

### 🎯 100% 완료된 시스템들

#### 1. 플레이어 핵심 시스템 ✅
- **PlayerController**: WASD 이동, 마우스 회전, 좌클릭 공격, 우클릭 스킬
- **PlayerStatsManager**: 네트워크 동기화된 스탯 관리, 민댐/맥댐 계산
- **PlayerStats**: 종족별 고정 성장 (15레벨 최대)
- **PlayerVisualManager**: 종족별 스프라이트 및 애니메이션 (4방향)

#### 2. 종족 시스템 ✅  
```
인간 (균형형): 기본 모든 스탯 10, 레벨당 전체 +1
엘프 (마법형): INT 15 시작, INT +2/레벨, 마법 계열 5개 카테고리
수인 (물리형): STR 15 시작, STR +2/레벨, 야성 계열 8개 카테고리  
기계족 (방어형): VIT/DEF 15 시작, 기술 계열 8개 카테고리
```

#### 3. 전투 시스템 ✅
- **CombatSystem**: 실시간 PvP/PvE 전투, 민댐/맥댐 적용
- **MonsterAI**: 6개 상태 기반 AI (Idle→Patrol→Chase→Attack→Return→Dead)
- **MonsterSpawner**: 플레이어 레벨 기반 동적 스폰 + 레벨 조정
- **MonsterHealth**: 경험치/아이템/영혼 드롭 연동

#### 4. 아이템 시스템 ✅
- **ItemData**: 5등급 시스템 (Common 60% → Legendary 1%)  
- **ItemInstance**: 개별 인스턴스 관리 (내구도, 인챈트, 스택)
- **ItemDatabase**: 효율적 검색 시스템
- **DroppedItem**: 물리적 아이템 표현 + 등급별 색상 + 자동 픽업

#### 5. 인벤토리 시스템 ✅
- **InventoryManager**: 30슬롯 네트워크 동기화
- **InventoryUI**: 드래그&드롭 인터페이스 (I키 토글)
- **자동 스택**: 같은 아이템 자동 합치기 + 정렬 기능

#### 6. 장비 시스템 ✅
- **EquipmentManager**: 11개 장비 슬롯 (Head/Chest/Legs/Feet/Hands/MainHand/OffHand/TwoHand/Ring1/Ring2/Necklace)
- **EquipmentUI**: 드래그&드롭 장착 (E키 토글)
- **스탯 연동**: 장비 스탯이 플레이어 스탯에 실시간 반영

#### 7. 스킬 시스템 ✅
- **골드 기반 학습**: 스킬 포인트 없음, 골드로만 구매
- **5티어 진행**: 3/6/9/12/15레벨에 새 티어 해금
- **종족별 특화**: 총 28개 스킬 카테고리
```
인간: Warrior, Paladin, Rogue, Archer (4개)
엘프: ElementalMage, PureMage, NatureMage, PsychicMage, Nature (5개)  
수인: Berserker, Hunter, Assassin, Beast, Wild, ShapeShift, Hunt, Combat (8개)
기계족: HeavyArmor, Engineer, Artillery, Nanotech, Engineering, Energy, Defense, Hacking (8개)
```

#### 8. 데스 페널티 시스템 ✅
- **완전한 캐릭터 삭제**: 사망 즉시 모든 진행도 소실
- **ItemScatter**: 등급별 차등 흩뿌리기 (전설=3배 반경)
- **CharacterDeletion**: 복구 불가능한 영구 삭제
- **SoulPreservation**: 계정 영혼 보존 시스템

#### 9. 영혼 시스템 ✅
- **0.1% 드롭률**: 몬스터에서 극악의 확률로 드롭
- **계정 귀속**: 유일한 영구 진행도
- **15개 슬롯**: 레벨당 1개씩 장착 가능
- **시각 효과**: 발광 + 부유 애니메이션

#### 10. 파티 시스템 ✅
- **16명 파티**: 최대 16명까지 파티 구성 가능
- **PartyUI**: 완전한 인터페이스 (P키 토글)
- **동시 스폰**: 파티원들은 같은 위치에 스폰

#### 11. 던전 스케줄링 시스템 ✅
- **5분 간격 입장**: 모든 플레이어가 동시 입장
- **동심원 배치**: 중앙(2그룹)/내층(4그룹)/외층(나머지) 존
- **파티 우선**: 파티는 근처 스폰, 솔로는 랜덤

#### 12. 인챈트 시스템 ✅ (최근 완료)
- **1% 드롭률**: 몬스터에서 인챈트 아이템 드롭
- **무기 강화**: 최대 3개 인챈트 적용 가능
- **속성 부여**: 화염/냉기/번개/독/암흑/신성 + 특수 효과

---

## 🚧 현재 개발 진행 상황

### 📈 우선순위 1: 즉시 개발 필요 🔥

#### 1. 완전한 던전 시스템 ✅ **완료!**
**진행도: 95%** (모든 핵심 기능 완료)
```
완료됨:
✅ DungeonManager - 던전 인스턴스 관리
✅ DungeonScheduler - 5분 간격 스케줄링  
✅ DungeonTypes - 네트워크 직렬화 구조체들
✅ PartySpawnGroup - 파티별 스폰 그룹핑
✅ 층별 시간 제한 시스템 (DungeonData.CalculateFloorTimeLimit)
✅ 시간 carryover 시스템 (AdvanceToNextFloorServerRpc에 구현)
✅ 강제 방출 시스템 (ForceEjectAllPlayersServerRpc)
✅ 포탈 시스템 (DungeonExit.cs - 완전 구현)
✅ DungeonUI - 시간 표시, 층별 진행도, 플레이어 상태

추후 개선 가능:
💡 유연한 맵 구조 시스템 (현재는 기본 구조 사용)
💡 시각적 맵 에디터 도구
```

#### 2. UI/UX 완성도 향상 ✅ **완료!**
**진행도: 95%** (프리팹 아키텍처 완성)
```
완료됨:
✅ InventoryUI (I키) - 드래그&드롭 완료
✅ EquipmentUI (E키) - 장착 시스템 완료
✅ PartyUI (P키) - 파티 관리 완료
✅ DungeonUI - 시간 표시, 층별 진행도, 플레이어 상태
✅ PlayerHUD - HP/MP바, 경험치바, 골드 표시
✅ UIManager - 프리팹 로드 시스템
✅ UIPrefabGenerator - 자동 프리팹 생성 도구
✅ UI_PREFAB_GUIDE.md - 완전한 프리팹 구성 가이드

아키텍처 혁신:
🚀 프리팹 기반 동적 로드 시스템
🚀 Resources/UI 경로 표준화
🚀 자동 프리팹 생성 에디터 도구
🚀 UIManager 싱글톤 패턴

추후 개선 가능:
💡 StatsUI 종족별 스탯 특화 표시
💡 SkillUI 스킬 트리 시각화
💡 DeathUI 영혼 선택 인터페이스
```

### 📈 우선순위 2: 핵심 확장

#### 3. PvP 밸런싱 시스템 ✅ **완료!**
**진행도: 95%** (고급 PvP 시스템 완성)
```
완료됨:
✅ 기본 PvP 가능 (던전 내에서)
✅ 파티원 간 공격 방지
✅ 사망 시 아이템 드롭
✅ PvPBalanceSystem.cs - 완전한 밸런싱 시스템
✅ 종족 간 상성 시스템 (엘프 vs 기계족 등)
✅ 킬/데스 리워드 시스템 (경험치, 골드)
✅ 복수 시스템 (5분간 복수 기회)
✅ 킬 스트릭 시스템 (연속 킬 보너스)
✅ 데스 페널티 (경험치 손실, 골드 드롭)
✅ CombatSystem 연동 완료

고급 기능:
🚀 종족별 상성 밸런스 (20% 효과)
🚀 복수 성공 시 50% 추가 보너스
🚀 킬 스트릭별 보상 증가 (최대 100%)
🚀 실시간 킬 스트릭 알림 시스템

추후 개선 가능:
💡 PvP 전용 스킬 효과
💡 길드 vs 길드 PvP
💡 PvP 랭킹 시스템
```

#### 4. Economy System 확장 ✅ **완료!**
**진행도: 95%** (완전한 경제 생태계 구축)
```
완료됨:  
✅ 골드 기본 스킬 구매
✅ 몬스터 처치 시 골드 드롭
✅ 사망 시 골드 드롭
✅ EconomySystem.cs - 완전한 경제 관리 시스템
✅ 층별 골드 드롭량 밸런싱 (층당 20% 증가)
✅ 귀환 비용 시스템 (첫 100골드 → 1.5배 증가)
✅ NPC 상점 시스템 (무기, 방어구, 소모품)
✅ ShopUI.cs - 상점 인터페이스 (B키)
✅ 수리 시스템 (내구도당 2골드)
✅ 상점 카테고리 필터링

고급 기능:
🚀 동적 가격 시스템 (상점 배율 1.2배)
🚀 귀환 횟수별 비용 증가 (최대 10,000골드)
🚀 아이템 타입별 색상 구분
🚀 구매 확인 시스템
🚀 골드 부족/인벤토리 풀 알림

추후 개선 가능:
💡 경매장 시스템
💡 플레이어 간 거래
💡 동적 시장 가격
💡 계절별 할인 이벤트
```

### 📈 우선순위 3: 고급 시스템

#### 5. 고급 던전 컨텐츠
```
🔧 보스 몬스터 시스템 (층별 고유 보스)
🔧 히든 11층 시스템 (10층 클리어 시 진입 가능)
🔧 던전 환경 요소 (함정, 보물상자, 비밀 통로)  
🔧 층별 특수 규칙 (7층+ 경험치 2배, 9층+ PvP 강제 등)
```

#### 6. Save System
```
🔧 계정 데이터 저장 (영혼 컬렉션)
🔧 캐릭터 데이터 저장 
🔧 클라우드 저장 지원
🔧 백업 및 복구 시스템
```

---

## 🎯 밸런싱 철학 & 수치 설계

### ⚖️ 핵심 수치 체계

#### 스탯 계산 공식
```csharp
// 기본 능력치
HP = 100 + (VIT * 10)
MP = 50 + (INT * 5)  
물리 공격력 = STR * 2
마법 공격력 = INT * 2
이동속도 = 5.0 + (AGI * 0.1)
공격속도 = 1.0 + (AGI * 0.01)

// 방어 공식 (효율성 감소)
물리 방어율 = DEF / (DEF + 100) * 100%
마법 방어율 = MDEF / (MDEF + 100) * 100%

// 확률 시스템
회피율 = AGI * 0.1%
크리티컬 확률 = LUK * 0.05%
드롭률 증가 = LUK * 0.01%
```

#### 민댐/맥댐 시스템 세부사항
```csharp
// 무기별 편차 특성
균형형 (롱소드): 80-120% 편차
도박형 (워해머): 40-160% 편차  
안정형 (대거): 90-110% 편차
마법형 (스태프): 50-150% 편차

// 등급별 편차 확대
일반: ±10%
희귀: ±15%  
영웅: ±20%
전설: ±25%
신화: ±30%

// 안정성 스탯 효과
실제 민댐 = 기본 민댐 + (STAB * 0.5)
실제 맥댐 = 기본 맥댐 - (STAB * 0.3)
```

#### 드롭률 시스템
```
몬스터 아이템 드롭:
- Common: 60%
- Uncommon: 25% 
- Rare: 10%
- Epic: 4%
- Legendary: 1%

특수 드롭:
- 영혼: 0.1% (LUK 보정)
- 인챈트: 1% (LUK 보정)
- 보스 고유 아이템: 5-20%
```

#### 스킬 비용 시스템  
```
티어별 기본 비용:
1티어 (3레벨): 100-200골드
2티어 (6레벨): 500-800골드
3티어 (9레벨): 2000-3000골드  
4티어 (12레벨): 8000-15000골드
5티어 (15레벨): 50000-100000골드

골드 획득량 (층별):
1층: 1-5골드/몬스터
5층: 50-150골드/몬스터  
10층: 3000-10000골드/몬스터
```

---

## 🚀 개발 마일스톤

### 🎯 마일스톤 1: 알파 버전 (완료) ✅
**2025-08-17 완료**
- [x] 기본 플레이어 시스템 (이동, 공격, 네트워킹)
- [x] 종족 시스템 (4종족 고정 성장)
- [x] 기본 전투 시스템 (PvE)
- [x] 네트워킹 기반 (16명 동시 접속)

### 🎯 마일스톤 2: 베타 버전 (완료) ✅  
**2025-08-18 완료**
- [x] 완전한 스킬 시스템 (골드 기반, 5티어, 28카테고리)
- [x] 완전한 데스 페널티 시스템
- [x] 영혼 시스템 (0.1% 드롭률)
- [x] 아이템/인벤토리/장비 시스템
- [x] 파티 시스템 (16명 파티)
- [x] 던전 스케줄링 시스템
- [x] 인챈트 시스템 (1% 드롭률)

### 🎯 마일스톤 3: 감마 버전 (진행 중) 🚧
**목표: 2025-09 완료**
- [ ] 완전한 던전 시스템 (시간 제한, 강제 방출)
- [ ] UI/UX 완성도 (모든 UI 폴리싱)  
- [ ] PvP 밸런싱 (종족 간 균형)
- [ ] 경제 시스템 완성 (귀환 비용, NPC 상점)

### 🎯 마일스톤 4: 델타 버전 (계획) 📋
**목표: 2025-10 완료**
- [ ] 고급 던전 컨텐츠 (보스, 히든층)
- [ ] Save System (클라우드 저장)
- [ ] 성능 최적화 (16명 60fps 보장)
- [ ] 최종 밸런싱

### 🎯 마일스톤 5: 릴리즈 후보 (계획) 🎉
**목표: 2025-11 완료**  
- [ ] 보안 강화 (치트 방지)
- [ ] 버그 수정 및 안정화
- [ ] 최종 테스트 (50명 스트레스 테스트)

---

## 📊 기술 부채 현황

### 🔧 해결 완료된 항목들 ✅
- **NetworkList IEquatable<T> 문제**: 모든 네트워크 구조체에 패턴 적용 완료
- **컴파일 에러 30+개**: 타입 시스템 일관성 확보 완료  
- **StatBlock 필드 명명**: .STR → .strength 통일 완료
- **아이템 시스템 일관성**: ItemGrade/ItemType 통합 완료
- **파티 스폰 그룹**: NetworkList 호환성 문제 해결 완료

### 🔧 해결 필요한 기술 부채

#### 높음 우선순위
1. **CharacterData 클래스 누락**
   - 위치: `PlayerStatsManager.cs:106`
   - 영향: 캐릭터 생성 시스템
   - 해결 방안: 캐릭터 생성 데이터 구조 설계

2. **던전 시간 제한 시스템 미완성**
   - 위치: `DungeonManager.cs`
   - 영향: 핵심 게임플레이 루프
   - 해결 방안: 층별 시간 관리 시스템 구현

#### 중간 우선순위  
3. **성능 최적화**
   - ResourceLoader 캐시 개선
   - 네트워크 패킷 최적화
   - UI 렌더링 최적화

4. **코드 품질**
   - PlayerStats 클래스 책임 분리
   - Magic Number 상수화  
   - 리플렉션 사용 최소화

---

## 🎮 게임플레이 검증 완료

### ✅ 현재 완전히 플레이 가능한 루프

1. **캐릭터 생성** → RaceData 기반 종족 선택 ✅
2. **스킬 학습** → NPC에서 골드로 구매 ✅  
3. **파티 구성** → 16명까지 파티 가능 ✅
4. **던전 입장** → 5분마다 스케줄된 입장 ✅
5. **전투 및 성장** → PvE + 아이템 수집 ✅
6. **사망 처리** → 모든 아이템 드롭 + 캐릭터 삭제 ✅
7. **영혼 획득** → 0.1% 확률로 계정 보존 ✅
8. **새 캐릭터** → 영혼 보너스와 함께 재시작 ✅

### 🎯 검증된 핵심 특징들

#### 하드코어 데스 페널티 ✅
- 사망 시 캐릭터 완전 삭제 확인
- 아이템 등급별 차등 흩뿌리기 확인
- 영혼만 계정 보존 확인

#### 민댐/맥댐 시스템 ✅
- 모든 무기의 데미지 범위 적용 확인
- 종족별 스탯 차이 반영 확인
- 크리티컬/방어력 계산 정상 작동 확인

#### 네트워킹 안정성 ✅  
- 16명 동시 접속 테스트 완료
- 파티 동시 스폰 확인
- 아이템 드롭 동기화 확인

---

## 📈 현재 상태: **베타 85% 완성도**

프로젝트는 현재 **고도로 완성된 베타 상태**입니다. 

**✨ 완전히 플레이 가능**: 모든 핵심 게임플레이 루프가 구현되어 있으며, 하드코어 던전 크롤러의 본질적 재미를 온전히 경험할 수 있습니다.

**🎯 다음 단계**: 던전 시간 제한 시스템과 UI 폴리싱을 통해 **감마 버전(95% 완성도)**을 목표로 합니다.

---

## 🎪 최종 비전

**"극한의 긴장감 속에서 단 하나의 영혼이 주는 희망"**

하드코어 던전 크롤러는 죽음이 모든 것을 앗아가지만, 0.1% 확률의 영혼 하나가 영원한 성장의 씨앗이 되는 게임입니다. 매 순간이 생사를 가르는 선택이며, 16명의 플레이어가 협력과 배신 사이에서 살아남기 위해 치열하게 경쟁하는 궁극의 하드코어 경험을 제공합니다.